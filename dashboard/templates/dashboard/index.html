<!DOCTYPE html>
<html>
<head>
    <title>SmartField Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .trait-box {
            display: inline-block;
            padding: 4px 8px;
            margin: 2px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .‚úîÔ∏è { background-color: #d4edda; }
        .‚è≥ { background-color: #fff3cd; }
        .‚ùå { background-color: #f8d7da; }
        .üïì { background-color: #e2e3e5; }
        .legend { margin-top: 10px; }
        .legend span { margin-right: 15px; }
    </style>
</head>
<body>
{% load filters %}
<h1>SmartField Supervisor Dashboard</h1>
<a href="/upload/">Upload SmartField CSV</a> |
<a href="/upload-schedule/">Upload Trait Schedule</a>

{% if headers %}
  <h2>Data Preview</h2>
  <table border="1">
    <tr>{% for header in headers %}<th>{{ header }}</th>{% endfor %}</tr>
    {% for row in data %}
      <tr>{% for header in headers %}<td>{{ row|get_item:header }}</td>{% endfor %}</tr>
    {% endfor %}
  </table>

  <h2>Trait Status by Plot</h2>
  <table border="1">
    <tr>
      <th>Plant ID</th>
      {% for trait in trait_flags.values.0.keys %}<th>{{ trait }}</th>{% endfor %}
    </tr>
    {% for pid, flags in trait_flags.items %}
      <tr>
        <td>{{ pid }}</td>
        {% for trait, status in flags.items %}
          <td><span class="trait-box {{ status }}">{{ status }}</span></td>
        {% endfor %}
      </tr>
    {% endfor %}
  </table>

  <div class="legend">
    <strong>Legend:</strong>
    <span class="trait-box ‚úîÔ∏è">‚úîÔ∏è Completed</span>
    <span class="trait-box ‚è≥">‚è≥ Due Soon</span>
    <span class="trait-box ‚ùå">‚ùå Overdue</span>
    <span class="trait-box üïì">üïì Too Early</span>
  </div>

  <h2>Trait Completeness per Plot</h2>
  <canvas id="plotChart" width="800" height="400"></canvas>

  <h2>Summary of Plot Completion</h2>
  <canvas id="summaryChart" width="400" height="400"></canvas>

  <script>
    const plotLabels = {{ plot_labels|safe }};
    const plotData = {{ plot_data|safe }};
    const plotColors = {{ plot_colors|safe }};
    const summaryLabels = ["Complete", "Incomplete", "Empty"];
    const summaryData = {{ summary_data|safe }};

    new Chart(document.getElementById('plotChart').getContext('2d'), {
      type: 'bar',
      data: {
        labels: plotLabels,
        datasets: [{
          label: 'Completed Traits',
          data: plotData,
          backgroundColor: plotColors
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { display: false },
          title: { display: true, text: 'Per-Plot Trait Completeness' }
        },
        scales: {
          y: { beginAtZero: true }
        }
      }
    });

    new Chart(document.getElementById('summaryChart').getContext('2d'), {
      type: 'doughnut',
      data: {
        labels: summaryLabels,
        datasets: [{
          label: 'Plot Status',
          data: summaryData,
          backgroundColor: ['green', 'orange', 'red']
        }]
      },
      options: {
        responsive: true,
        plugins: {
          title: { display: true, text: 'Plot Completion Summary' }
        }
      }
    });
  </script>
{% endif %}
</body>
</html>
